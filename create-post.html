<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Create Post</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

<div class="app">

  <!-- HEADER -->
  <header class="header">
    <a href="folder.html" class="gear">‚Üê</a>
    <span class="title" id="pageTitle">Create Post</span>
    <span></span>
  </header>

  <!-- FOLDER CONTEXT -->
  <section class="cards">
    <div class="card">
      <div class="card-text">
        <strong id="folderName">Folder</strong>
        <span>Posting into this folder</span>
      </div>
    </div>
  </section>

  <!-- UPLOAD -->
  <section class="cards">
    <div class="card">
      <div class="card-text">
        <strong>Upload Media</strong>
        <span>Video for YouTube (image later)</span>
      </div>
      <input type="file" id="mediaFile" accept="video/*" />
    </div>
  </section>

  <!-- POST IDEA -->
  <section class="cards">
    <div class="card">
      <textarea
        id="postIdea"
        placeholder="What is this post about?"
        style="width:100%; min-height:80px;"
      ></textarea>
    </div>
  </section>

  <!-- ACTIONS -->
  <section class="cards">
    <div class="card post green" onclick="generateSEO()">
      <div class="icon green">‚ú®</div>
      <div class="card-text">
        <strong>Generate SEO</strong>
        <span>Title, description & hashtags</span>
      </div>
      <div class="arrow">‚Ä∫</div>
    </div>
  </section>

  <!-- SEO OUTPUT -->
  <section class="cards">
    <div class="card">
      <div class="card-text">
        <strong>YouTube Title</strong>
      </div>
      <textarea id="ytTitle"></textarea>
    </div>

    <div class="card">
      <div class="card-text">
        <strong>YouTube Description</strong>
      </div>
      <textarea id="ytDescription" style="min-height:120px;"></textarea>
    </div>

    <div class="card">
      <div class="card-text">
        <strong>Hashtags</strong>
      </div>
      <textarea id="ytHashtags"></textarea>
    </div>
  </section>

  <!-- PUBLISH -->
  <section class="cards">
    <div class="card post green" onclick="publishPost()">
      <div class="icon green">üöÄ</div>
      <div class="card-text">
        <strong>Publish</strong>
        <span>YouTube (MVP mode)</span>
      </div>
      <div class="arrow">‚Ä∫</div>
    </div>
  </section>

</div>

<script>
  // -----------------------------
  // LOAD CONTEXT
  // -----------------------------
  const folders = JSON.parse(localStorage.getItem("folders")) || [];
  const activeFolderIndex = localStorage.getItem("activeFolder");
  const folder = folders[activeFolderIndex];

  if (!folder) {
    alert("Folder not found");
    window.location.href = "posting.html";
  }

  document.getElementById("folderName").textContent = folder.name;
  document.getElementById("pageTitle").textContent =
    `Create Post ‚Äì ${folder.name}`;

  // Ensure drafts array exists
  folder.drafts = folder.drafts || [];

  // -----------------------------
  // GENERATE SEO (MVP)
  // -----------------------------
  function generateSEO() {
    const idea = document.getElementById("postIdea").value.trim();
    if (!idea) {
      alert("Enter a post idea first");
      return;
    }

    const title = `${idea} | ${folder.name}`;
    const description =
`${idea}

${folder.brand?.cta || ""}

Subscribe for more from ${folder.name}`;

    const hashtags =
      (folder.brand?.hashtags || "")
        .split(",")
        .map(t => t.trim())
        .filter(Boolean)
        .map(t => `#${t.replace(/\s+/g, "")}`)
        .join(" ");

    document.getElementById("ytTitle").value = title;
    document.getElementById("ytDescription").value = description;
    document.getElementById("ytHashtags").value = hashtags;
  }

  // -----------------------------
  // PUBLISH (MVP MODE)
  // -----------------------------
  function publishPost() {
    const fileInput = document.getElementById("mediaFile");
    const title = document.getElementById("ytTitle").value;
    const description = document.getElementById("ytDescription").value;
    const hashtags = document.getElementById("ytHashtags").value;

    if (!fileInput.files.length) {
      alert("Please select a video file");
      return;
    }

    if (!title || !description) {
      alert("Generate SEO before publishing");
      return;
    }

    const draft = {
      idea: document.getElementById("postIdea").value,
      seo: { title, description, hashtags },
      fileName: fileInput.files[0].name,
      createdAt: Date.now()
    };

    folder.drafts.push(draft);
    folders[activeFolderIndex] = folder;
    localStorage.setItem("folders", JSON.stringify(folders));

    // MVP publish action
    alert("Draft saved. Opening YouTube Studio‚Ä¶");
    window.open("https://studio.youtube.com", "_blank");
  }
</script>

</body>
</html>
