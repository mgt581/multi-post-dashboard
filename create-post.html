<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="data:," />
  <title>Multipost Pro SEO</title>
  <!-- deploy bump v2 -->
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #eef7fb; margin: 0; padding: 0; }
    .app { padding: 20px; max-width: 600px; margin: 0 auto; }
    .header { display: flex; align-items: center; justify-content: space-between; padding: 14px 20px; background: #e8f5fb; border-bottom: 2px solid #9fd3ea; position: sticky; top: 0; z-index: 100; }
    .header a { text-decoration: none; font-size: 20px; color: #333; }
    .header .title { font-weight: 700; font-size: 18px; }
    .card { background: #e8f5fb; border: 2px solid #9fd3ea; border-radius: 16px; padding: 16px; margin-bottom: 16px; }
    .section-title { font-size: 20px; font-weight: 700; margin-bottom: 8px; }
    .form-group { margin-bottom: 15px; }
    label { display: block; font-size: 14px; font-weight: 600; color: #444; margin-bottom: 5px; }
    textarea, input { width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #9fd3ea; font-size: 16px; box-sizing: border-box; margin-bottom: 8px; background: white; }
    textarea { min-height: 110px; resize: vertical; }
    .btn { width: 100%; display: flex; align-items: center; justify-content: center; padding: 14px 16px; border-radius: 12px; border: 0; cursor: pointer; font-size: 16px; font-weight: 700; background: #2fa84f; color: white; transition: transform 0.1s, opacity 0.2s; }
    .btn:active { transform: scale(0.98); }
    .btn.secondary { background: #1b74e4; margin-top: 10px; }
    .btn.loading { opacity: 0.7; cursor: progress; pointer-events: none; }
  </style>
</head>
<body>
  <div class="header">
    <a href="folder.html">‚Üê</a>
    <div class="title">Multipost Pro SEO</div>
    <div style="width: 24px;"></div>
  </div>

  <div class="app">
    <div class="card">
      <div class="section-title">Tell us about your video</div>
      <div class="form-group">
        <label for="videoPrompt">Video Description</label>
        <textarea id="videoPrompt" placeholder="Describe your video for Pro SEO generation..."></textarea>
      </div>
      <div id="status" style="font-size:13px;color:#555;margin:4px 0 8px;min-height:18px;"></div>
      <button class="btn" id="generateBtn">‚ú® Generate Pro SEO</button>
    </div>

    <div class="card">
      <div class="section-title">YouTube</div>
      <div class="form-group">
        <label for="ytTitle">YouTube Title</label>
        <input id="ytTitle" placeholder="YouTube Title" />
      </div>
      <div class="form-group">
        <label for="ytDesc">Full Description</label>
        <textarea id="ytDesc" placeholder="Full Description"></textarea>
      </div>
      <div class="form-group">
        <label for="ytKeywords">20 Trending Keywords</label>
        <textarea id="ytKeywords" placeholder="20 Trending Keywords"></textarea>
      </div>
      <button class="btn secondary" onclick="copyYoutube()">üöÄ Copy & Go to YouTube</button>
    </div>

    <div class="card">
      <div class="section-title">TikTok</div>
      <div class="form-group">
        <label for="ttAllInOne">Title, Desc, Tags & Keywords</label>
        <textarea id="ttAllInOne" placeholder="Title, Desc, Tags & Keywords combined"></textarea>
      </div>
      <button class="btn secondary" onclick="copyGeneric('ttAllInOne', 'TikTok', 'https://www.tiktok.com/upload')">üì± Copy & Go to TikTok</button>
    </div>

    <div class="card">
      <div class="section-title">Facebook Reels</div>
      <div class="form-group">
        <label for="fbTitle">Reel Title</label>
        <input id="fbTitle" placeholder="Reel Title" />
      </div>
      <div class="form-group">
        <label for="fbDetails">Description, Tags & Keywords</label>
        <textarea id="fbDetails" placeholder="Description, Tags & Keywords"></textarea>
      </div>
      <button class="btn secondary" onclick="copyFB()">üì∏ Copy & Go to Facebook</button>
    </div>
  </div>

  <script>
    const apiBase = "https://multipost-seo-worker.alexbryant.workers.dev/api";

    async function generateSEO() {
      const prompt = document.getElementById("videoPrompt").value.trim();
      if (!prompt) return alert("Please describe your video!");

      const btn = document.getElementById("generateBtn");
      const statusEl = document.getElementById("status");
      const originalText = btn.innerText;
      btn.innerText = "Analyzing Trends...";
      btn.classList.add("loading");
      statusEl.textContent = "";

      try {
        const res = await fetch(`${apiBase}/generate-seo`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt })
        });

        if (!res.ok) {
          const bodyText = await res.text();
          throw new Error(`Server error: ${res.status} ${bodyText || ""}`.trim());
        }

          const json = await res.json();
          if (!json.success) throw new Error(json.error || "AI Error");

          // Parse model output even if it comes back as a fenced string
          const coerceToText = value => {
            if (Array.isArray(value)) return value.join(", ");
            if (value === null || value === undefined) return "";
            return String(value);
          };

          const parseJsonSafe = value => {
            if (!value) return null;
            if (typeof value !== "string") return value;
            const trimmed = value.trim();
            const fenced = trimmed.match(/```(?:json)?\s*([\s\S]*?)```/i);
            const body = fenced ? fenced[1].trim() : trimmed;
            try { return JSON.parse(body); } catch { return null; }
          };

          const raw = json?.data?.response ?? json?.data ?? json;
          const parsed = parseJsonSafe(raw) || raw || {};
          const d = parsed?.data ?? parsed ?? {};

          const youtube = d.youtube || {};
          const tiktok = d.tiktok || {};
          const facebook = d.facebook || {};

          const youtubeTitle =
            youtube.title ?? d.youtubeTitle ?? d.title ?? prompt;
          const fullDescription =
            youtube.description ??
            d.youtubeDescription ??
            d.fullDescription ??
            d.description ??
            prompt;
          const trendingKeywords =
            youtube.keywords ??
            youtube.tags ??
            d.trendingKeywords ??
            d.keywords ??
            "";

          statusEl.textContent = "AI response received";
          document.getElementById("ytTitle").value = coerceToText(youtubeTitle);
          document.getElementById("ytDesc").value = coerceToText(fullDescription);
          document.getElementById("ytKeywords").value = coerceToText(trendingKeywords);

          document.getElementById("ttAllInOne").value = coerceToText(
            tiktok.allInOne ??
            tiktok.all_in_one ??
            tiktok.caption ??
            d.tiktokAllInOne ??
            d.tiktokCaption ??
            d.tiktokText ??
            d.caption ??
            tiktok.text ??
            prompt
          );

          document.getElementById("fbTitle").value = coerceToText(
            facebook.title ?? d.facebookTitle ?? prompt
          );
          document.getElementById("fbDetails").value = coerceToText(
            facebook.descriptionAndTags ??
              d.facebookDetails ??
              facebook.description ??
              facebook.tags ??
              prompt
          );
      } catch (err) {
        console.error(err);
        statusEl.textContent = err.message;
        alert("Error: " + err.message);
      } finally {
        btn.innerText = originalText;
        btn.classList.remove("loading");
      }
    }

    function copyYoutube() {
      const title = document.getElementById("ytTitle").value;
      const desc = document.getElementById("ytDesc").value;
      const keywords = document.getElementById("ytKeywords").value;
      const text = `TITLE:\n${title}\n\nDESC:\n${desc}\n\nKEYWORDS:\n${keywords}`;
      navigator.clipboard.writeText(text).then(() => {
        alert("YouTube SEO Copied!");
        window.open("https://www.youtube.com/upload", "_blank");
      });
    }

    function copyFB() {
      const title = document.getElementById("fbTitle").value;
      const details = document.getElementById("fbDetails").value;
      const text = `TITLE:\n${title}\n\nDETAILS:\n${details}`;
      navigator.clipboard.writeText(text).then(() => {
        alert("Facebook SEO Copied!");
        window.open("https://www.facebook.com/reels/create", "_blank");
      });
    }

    function copyGeneric(id, name, url) {
      const text = document.getElementById(id).value;
      navigator.clipboard.writeText(text).then(() => {
        alert(name + " SEO Copied!");
        window.open(url, "_blank");
      });
    }

    document.getElementById("generateBtn").addEventListener("click", generateSEO);
  </script>
</body>
</html>
